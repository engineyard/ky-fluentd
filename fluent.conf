<source>
  @type  forward
  @id    input1
  @label @mainstream
  port  24224
</source>

<label @mainstream>
  <match kube.var.log.containers.**>
    @type detect_exceptions
    remove_tag_prefix kube
    languages ruby, go, js
    multiline_flush_interval 0.1
  </match>
  <match **>
    @type elasticsearch
    host "#{ENV["ES_HOST"]}"
    port "#{ENV["ES_PORT"]}"
    scheme https
    reload_connections false
    reconnect_on_error true
    reload_on_failure true
    index_name ky_logs
    type_name fluentd
    include_tag_key true
    tag_key _fluentd_tag
    log_es_400_reason true
    # buffer_type memory
    # buffer_chunk_limit 5m
    # num_threads 8
    <buffer>
        @type memory
        flush_thread_count 8
        chunk_limit_size 5m
      </buffer>
  </match>
</label>
